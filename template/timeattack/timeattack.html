<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Markcraft</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.2/dist/full.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked@3.0.7/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>

  <script src="https://tistory4.daumcdn.net/tistory/3134841/skin/images/confetti_vs2.js"></script>


</head>
<style>
  .text-markcraft {
    color: #21ca70;
  }

  .bg-markcraft {
    background-color: #21ca70;
  }

  @font-face {
    font-family: "Orbit-Regular";
    src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2310@1.0/Orbit-Regular.woff2") format("woff2");
    font-weight: normal;
    font-style: normal;
  }

  .logo {
    font-family: "Orbit-Regular";
  }

  /* 백틱 관련 CSS*/
  /* 코드 블록 스타일링 */
  pre {
    background-color: #282c34;
    /* 어두운 배경색 */
    border-radius: 5px;
    /* 모서리 둥글게 */
    padding: 15px;
    /* 안쪽 여백 */
    overflow-x: auto;
    /* 가로 스크롤 */
    color: #a9b7c6;
    /* 텍스트 색상 */
    margin-top: 10px;
    /* 위 여백 */
    margin-bottom: 10px;
    /* 아래 여백 */
  }

  /* 인라인 코드 스타일링 (백틱 사용) */
  code {
    background-color: #f4f4f4;
    border: 1px solid #ddd;
    padding: 2px 4px;
    border-radius: 4px;
    font-family: 'Courier New', Courier, monospace;
  }

  /* 블록 내 코드 스타일링 */
  pre>code {
    background-color: transparent;
    /* 배경색 없음 */
    border: none;
    /* 테두리 없음 */
    padding: 0;
    /* 안쪽 여백 없음 */
    color: inherit;
    /* 부모 요소의 색상 상속 */
  }

  /* 폭죽 */

  @keyframes fireworks {
    0% {
      opacity: 0;
    }

    20% {
      opacity: 1;
    }

    100% {
      opacity: 0;
    }
  }
</style>
<nav class="container mx-auto">
  <div class="navbar bg-base-100">
    <div class="navbar-start">
      <div class="dropdown">
        <label tabindex="0" class="btn btn-ghost lg:hidden">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" />
          </svg>
        </label>
        <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
          <li><a href="/classroom.html">강의실</a></li>
          <li><a href="/timeattack.html">타임어택</a></li>
          <li><a href="/note.html">연습장</a></li>
        </ul>
      </div>
      <a href="/index.html" class="logo btn btn-ghost normal-case text-xl text-markcraft">Markcraft</a>
    </div>
    <div class="navbar-center hidden lg:flex">
      <ul class="menu menu-horizontal px-1">
        <li><a href="/classroom.html">강의실</a></li>
        <li><a href="/timeattack.html">타임어택</a></li>
        <li><a href="/note.html">연습장</a></li>
      </ul>
    </div>
    <div class="navbar-end">
      <a class="btn">로그아웃</a>
    </div>
  </div>
</nav>

<body>
  <main class="container mx-auto p-5">
    <h1 class="text-center text-3xl font-bold">타임어택</h1>
    <p id="currentTime" class="text-6xl text-center mt-10">00:00:00</p>
    <div class="text-center text-gray-400 mb-10">
      <p class="">현재 최고 기록</p>
      <span id="bestTime" class=""></span>
    </div>
    <div class="text-center">
      <progress class="progress progress-success w-56" value="40" max="100"></progress>
      <p class="text-gray-400">0/10</p>
    </div>
    <div class="flex flex-wrap">
      <div class="w-full lg:w-1/2 px-20">
        <p class="text-center fond-bold text-xl my-5">답안지</p>
        <!-- 사용자 입력 ID 설정 -->
        <textarea id="userInput" class="w-full textarea textarea-success" rows="5"></textarea>
      </div>
      <div class="w-full lg:w-1/2 px-20">
        <p class="text-center fond-bold text-xl my-5">문제</p>
        <!-- 사용자 미리보기 ID 설정 -->
        <!-- <div id="userOutput" class="border-2 p-5 border-success rounded-xl"></div> -->
        <!-- 정답 미리보기 추가 -->
        <!-- <h3>정답 미리보기:</h3> -->
        <div id="correctOutput" class="border-2 p-5 border-success rounded-xl" style="display:none;"></div>
      </div>
    </div>
    <div class="text-center">
      <button class="btn btn-success text-white btn-lg my-10">시작</button>
    </div>
  </main>
  <!-- 모달 마크업 -->
  <div id="completionModal" class="fixed z-10 inset-0 overflow-y-auto hidden">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
      <div class="fixed inset-0 transition-opacity">
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
      </div>
      <span class="hidden sm:inline-block sm:align-middle sm:h-screen"></span>&#8203;
      <div
        class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:align-middle sm:my-8 sm:w-full sm:max-w-lg">
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div class="mt-3 text-center sm:mt-0 sm:text-left">
              <h3 class="text-lg leading-6 font-medium text-gray-900">
                타임어택 완료!
              </h3>
              <div class="mt-2">
                <p id="completionTime" class="text-sm leading-5 text-gray-500">
                  여기에 걸린 시간이 표시됩니다.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
          <button onclick="closeModal()" class="btn btn-primary">
            확인
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>

    // 강의실, 타임어택
    // 예제 JSON 데이터
    const jsonData = {
      "questions": [
        {
          "id": 1,
          "userPrompt": "This is inline code.",
          "correctAnswer": "This is `inline code`.",
        },
        // {
        //   "id": 2,
        //   "userPrompt": "",
        //   "correctAnswer": "가나다"
        // },
        // {
        //   "id": 3,
        //   "userPrompt": "이것은 제목",
        //   "correctAnswer": "## 이것은 제목"
        // },
        // {
        //   "id": 4,
        //   "userPrompt": "여기에 본문을 입력하세요.\n\n이것은 강조된 텍스트입니다.",
        //   "correctAnswer": "여기에 본문을 입력하세요.\n\n이것은 **강조된** 텍스트입니다."
        // }
        // 추가적인 문제들...
      ]
    };

    // 현재 문제 인덱스
    let currentQuestionIndex = 0;
    const userInput = document.getElementById('userInput');
    const userOutput = document.getElementById('userOutput');
    const correctOutput = document.getElementById('correctOutput');
    const comparisonResult = document.getElementById('comparisonResult');
    const questionsContainer = document.getElementById('questionsContainer');

    // 현재 최고 기록
    let bestTime = document.getElementById('bestTime');
    bestTime.textContent = localStorage.getItem('bestTime') ? parseInt(localStorage.getItem('bestTime')) : Infinity;

    // 1. 타이머를 위한 변수 설정
    let timerInterval;
    let startTime;
    let timeDisplay = document.getElementById('currentTime');

    function convertTimeFormat(milliseconds) {
      let minutes = Math.floor(milliseconds / (60 * 1000));
      let seconds = Math.floor((milliseconds % (60 * 1000)) / 1000);
      let ms = milliseconds % 1000;

      return `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}:${String(ms).padStart(3, "0")}`;
    }


    // 2. 시작 버튼 클릭 이벤트 리스너 추가
    document.querySelector(".btn-success").addEventListener("click", function () {
      this.style.display = "none";  // 시작 버튼 숨기기
      startTimer();
      // 처음 문제 로드
      loadQuestion(currentQuestionIndex);
    });

    // 3. 타이머 시작/정지 함수
    function startTimer() {
      startTime = Date.now();
      timerInterval = setInterval(function () {
        let elapsedTime = Date.now() - startTime;
        timeDisplay.textContent = convertTimeFormat(elapsedTime)
      }, 10);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }


    // 문제가 모두 완료되었을 때 타이머를 멈추고 모달을 띄움
    function completeChallenges() {
      stopTimer();
      showModal();
    }




    // 모달을 보여주는 함수
    function showModal() {
      let completionModal = document.getElementById("completionModal");
      let completionTime = document.getElementById("completionTime");

      let currentScore = timeDisplay.textContent;
      if (currentScore < bestTime) {
        // 폭죽 애니메이션 추가
        let fireworks = document.createElement("div");
        fireworks.className = "fireworks";
        document.body.appendChild(fireworks);
        setTimeout(() => {
          document.body.removeChild(fireworks);
        }, 1000);
        bestTime = currentScore;
        localStorage.setItem('bestTime', bestTime);
        // 추가: 최고 기록 UI 업데이트
        completionTime.textContent = `축하합니다! 최고 기록을 경신하셨습니다!!\n\n걸린 시간: ${currentScore}`;
      } else {
        completionTime.textContent = `완료까지 걸린 시간: ${currentScore}`;
      }

      completionModal.style.display = "block";
    }


    // 모달을 닫는 함수
    function closeModal() {
      let completionModal = document.getElementById("completionModal");
      completionModal.style.display = "none";
      location.reload()
    }

    function loadQuestion(index) {
      console.log(index)
      // 문제 불러오기
      userInput.value = jsonData.questions[index].userPrompt;
      correctOutput.innerHTML = marked(jsonData.questions[index].correctAnswer);
      correctOutput.style.display = 'block';  // 정답 미리보기 보이기
      userInput.focus();
    }

    userInput.addEventListener('input', function () {
      // userOutput.innerHTML = marked(userInput.value); // 사용자 입력을 미리보기에 표시ㄴ
      document.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightBlock(block); // 코드 하이라이팅
      });

      if (marked(userInput.value).trim() === correctOutput.innerHTML.trim()) {
        // comparisonResult.textContent = "정답입니다!";
        // comparisonResult.style.color = "green";
        // userInput.style.borderColor = "#ccc";
        // 문제를 모두 풀면 모달을 보여주는 코드
        if (currentQuestionIndex === jsonData.questions.length - 1) {
          completeChallenges();
        } else {
          // setTimeout(loadNextQuestion, 2000);
          loadNextQuestion()
        }
      } else {
        // comparisonResult.textContent = "틀렸습니다. 다시 시도해보세요.";
        // comparisonResult.style.color = "red";
        // userInput.style.borderColor = "red";
      }
    });



    // 다음 문제 로드 함수
    function loadNextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < jsonData.questions.length) {
        loadQuestion(currentQuestionIndex);
        console.log(currentQuestionIndex)
      }
    }



  </script>


</body>

</html>